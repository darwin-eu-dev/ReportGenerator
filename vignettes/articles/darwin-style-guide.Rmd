---
title: "Darwin Style Guide"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
prevalence_attrition <- readRDS("prevalence_attrition.rds")
incidence_attrition <- readRDS("incidence_attrition.rds")

incidence_estimates <- readRDS("incidence_estimates.rds")
class(incidence_estimates) <- c("IncidencePrevalenceResult", "IncidenceResult", "tbl_df", "tbl", "data.frame")
prevalence_estimates <- readRDS("prevalence_estimates.rds")
class(incidence_estimates) <- c("IncidencePrevalenceResult", "IncidenceResult", "tbl_df", "tbl", "data.frame")
```

### INTRODUCTION

ReportGenerator aims to automate study reports, initially for Darwin's Off-the-Shelf studies. Those reports should be based on the requirements of the Complete Catalogue of Standard Data Analyses. In this article, we show in more detail every table and figure that ReportGenerator can include in a Word document, according to the guidelines established in the Darwin Style Guide. 

```{r setup, message= FALSE, warning=FALSE}
library(ReportGenerator)
```

### DRUG UTILISATION STUDIES (DUS)

#### Population-level DUS

### Table 1

##### Complete Catalogue of Standard Data Analyses:

Number of participants and total number of drug/s user/s in each source population during study period. Number of participants per pre-specified strata will be included where necessary/applicable.

##### General considerations:

ReportGenerator provides two options for this object. The first is derived from attrition data and is preferred to be the default option. ReportGenerator calls the function `table1NumPar()` to generate this table and include it in the report. It also generates an automated text description of the graph that the user can edit in the shiny app through the function `table1aAutText()`.
```{r, echo=FALSE, message= FALSE, warning=FALSE}
table1aAutText(incidence_attrition, prevalence_attrition)
```
```{r, message= FALSE, warning=FALSE}
table1NumPar(prevalence_attrition, incidence_attrition)
```


The second option describes the number of users by database, sex, age group, etc.

```{r, message= FALSE, warning=FALSE }
table1SexAge(incidence_estimates)
```

### Figure 1 Incidence over calendar time overall

##### Complete Catalogue of Standard Data Analyses:

Incidence rate/s of drug/s use over calendar time (per year) overall.

##### General considerations:

ReportGenerator identifies how many databases and how many outcomes are available to show in the figures. For each figure, the user interface of the package will show a drop-down menu to select the key visualisations of interest through a set of options. The user can select either a facet by outcome or database. ReportGenerator makes a call to the functions `plotIncidence()` from the IncidencePrevalence package to generate the figures.

```{r, include = FALSE}
incidence_estimates <- incidence_estimates %>% filter(denominator_age_group == "18 to 99",
                                                      denominator_sex == "Both")
```

Option A – facet by outcome, lines per database

```{r, message= FALSE, warning=FALSE }
IncidencePrevalence::plotIncidence(incidence_estimates, 
                                   colour = 'database_name', 
                                   facet = 'outcome_cohort_name')
```

Option B – facet by database, lines per database

```{r, message= FALSE, warning=FALSE }
IncidencePrevalence::plotIncidence(incidence_estimates, 
                                   colour = 'outcome_cohort_name', 
                                   facet = 'database_name')
```
